#!/usr/bin/env ruby

require 'optparse'

formatter = 'cli'

opts = OptionParser.new("", 24, '  ') do |opts|
  opts.banner = "Usage: baretest [options] [glob, ...]"

  opts.separator "glob defaults to 'test/**/*.rb'\n"
  opts.separator "Options:"

  opts.on("-f", "--formatter FORMATTER", "use FORMATTER for output") { |use|
  	formatter = use
  }

  opts.on("-d", "--debug", "set debugging flags (set $DEBUG to true)") {
    $DEBUG = true
  }

  opts.on("-v", "--version", "print the version and exit") {
    puts "baretest version 0.2"
    exit
  }

  opts.on("-w", "--warn", "turn warnings on for your script") {
    $VERBOSE = true
  }

	opts.parse! ARGV
end

if ARGV.empty? then
	Dir.glob('test/**/*.rb') { |path| load(path) }
else
	ARGV.each { |path| Dir.glob(path) { load(path) } }
end

Test.run.run(formatter)
